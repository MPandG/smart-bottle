# Hoosh Noosh smart bottle web service

HooshNoosh was a project for [IoT Hackaton](iotcup.ir)

Source code of HooshNoosh web service.
This web service has been made for IoTCup.ir , a IoT start up and it is not completely finished.

# Requirement
```
1. github.com/jinzhu/gorm ~ for database connection
2. github.com/go-sql-driver/mysql ~ MySQL driver
3. github.com/gorilla/mux ~ URL router and dispatcher
```


I use mysql database for this web service , the tables is :

#### MySQL Tables
````
+----------------------+
| Tables_in_hooshnoosh |
+----------------------+
| drinks               |
| logs                 |
| notifies             |
| profiles             |
| users                |
+----------------------+
````

And columns of each one is : 

#### Users

````
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| userid   | int(11)      | NO   | PRI | NULL    | auto_increment |
| userpass | varchar(50)  | NO   |     | NULL    |                |
| token    | varchar(100) | YES  |     | NULL    |                |
| username | varchar(100) | YES  |     | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
````

#### Profiles

````
+---------+---------+------+-----+---------+-------+
| Field   | Type    | Null | Key | Default | Extra |
+---------+---------+------+-----+---------+-------+
| userid  | int(11) | YES  |     | NULL    |       |
| age     | int(11) | YES  |     | NULL    |       |
| weight  | int(11) | YES  |     | NULL    |       |
| height  | int(11) | YES  |     | NULL    |       |
| is_male | int(11) | YES  |     | NULL    |       |
+---------+---------+------+-----+---------+-------+
````

#### Notifies

````
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| notify_id | int(11)      | NO   | PRI | NULL    | auto_increment |
| level     | int(11)      | NO   |     | NULL    |                |
| title     | varchar(255) | YES  |     | NULL    |                |
| content   | varchar(500) | YES  |     | NULL    |                |
| user_id   | int(11)      | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
````

#### Drinks

````
+---------+-------------+------+-----+---------+----------------+
| Field   | Type        | Null | Key | Default | Extra          |
+---------+-------------+------+-----+---------+----------------+
| drinkid | int(11)     | NO   | PRI | NULL    | auto_increment |
| userid  | int(11)     | NO   |     | NULL    |                |
| value   | int(11)     | YES  |     | NULL    |                |
| date    | varchar(30) | YES  |     | NULL    |                |
+---------+-------------+------+-----+---------+----------------+
````

#### Logs

````
+--------+--------------+------+-----+---------+----------------+
| Field  | Type         | Null | Key | Default | Extra          |
+--------+--------------+------+-----+---------+----------------+
| logid  | int(30)      | NO   | PRI | NULL    | auto_increment |
| userid | int(11)      | NO   |     | NULL    |                |
| level  | int(5)       | NO   |     | NULL    |                |
| detail | varchar(255) | NO   |     | NULL    |                |
| ip     | varchar(30)  | YES  |     | NULL    |                |
| date   | varchar(40)  | YES  |     | NULL    |                |
+--------+--------------+------+-----+---------+----------------+
````

The routes of web service is :

Name | Address | Method
--- | --- | ---
*newRegisteration* | */register/new/* | *POST*
*validateRegistration* | */register/validate/* | *GET*
*setProfile* | */profiles/set/* | *POST*
*getProfile* | */profiles/get/* | *GET*
*getNotification* | */notification/* | *GET*
*newDrinkRecord* | */drink/set/* | *POST*

**Note** that the authentication is very simple. I use a token generated by MD5 function from (username+salt+password). Username is unique so the token will be unique too.

#### Request , Response 

After sending request , server will send a response that contains a JSON string like this : 

```
{"success":true,"errorcode":0,"result":null}
```

The result's value maybe different by calling each functions , Result types is : 

````go

type ReturnUser struct {
	Token string `json:"token"`
}

type ErrorValue struct {
	Detail string `json:"errorname"`
}

type Profile struct {
	Age    int `json="age"`
	Height int `json="height"`
	Weight int `json="weight"`
	Userid int `json="userid"`
	IsMale int `json="is_male"`
}

type Notify struct {
	Level    int    `json="level"`
	Content  string `json="content"`
	Title    string `json="title"`
	NotifyID int    `json="id"`
}

type Drink struct {
	Drinkid int    `json="drink_id"`
	Userid  int    `json="user_id"`
	Value   int    `json="value"`
	Date    string `json="date"`
}

````

#### Android client side
<a href="https://github.com/Ali-Kabiri/smart-bottle">Smart-Bottle</a>
